---
// ChristmasLights.astro - Festive twinkling Christmas lights
interface Props {
  position?: 'top' | 'bottom';
}
const { position = 'top' } = Astro.props;
---

<div class={`christmas-lights-container christmas-lights-${position}`} data-christmas-lights hidden>
  <div class="lights-wrapper">
    {Array.from({ length: 40 }).map((_, i) => {
      const colors = ['red', 'green', 'blue', 'yellow', 'orange'];
      const color = colors[i % colors.length];
      const delay = Math.random() * 3;
      const duration = 1.5 + Math.random() * 1.5;

      return (
        <div
          class={`light light-${color}`}
          style={`--twinkle-delay: ${delay}s; --twinkle-duration: ${duration}s;`}
        >
          <div class="wire-connect"></div>
          <div class="bulb"></div>
          <div class="glow"></div>
        </div>
      );
    })}
  </div>
  <svg class="wire" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 5" preserveAspectRatio="none">
    <path d="M 0 2 Q 5 0.5, 10 2 T 20 2 T 30 2 T 40 2 T 50 2 T 60 2 T 70 2 T 80 2 T 90 2 T 100 2"
          fill="none"
          stroke="rgba(0, 0, 0, 0.3)"
          stroke-width="0.5"
          vector-effect="non-scaling-stroke"/>
  </svg>
</div>

<style>
  .christmas-lights-container {
    position: absolute;
    left: 0;
    right: 0;
    width: 100%;
    height: 60px;
    pointer-events: none;
    z-index: 100;
    overflow: hidden;
  }

  .christmas-lights-top {
    top: 0;
  }

  .christmas-lights-bottom {
    bottom: 0;
    transform: rotate(180deg);
  }

  .wire {
    position: absolute;
    top: -1px;
    left: 0;
    width: 100%;
    height: 5px;
    opacity: 0.5;
  }

  .lights-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding: 0 2%;
  }

  .light {
    position: relative;
    width: 15px;
    height: 30px;
  }

  .bulb {
    position: absolute;
    top: 6px;
    left: 50%;
    transform: translateX(-50%);
    width: 12px;
    height: 15px;
    border-radius: 40% 40% 50% 50%;
    box-shadow:
      inset 0 -2px 4px rgba(0, 0, 0, 0.2),
      0 2px 8px currentColor;
    animation: bulb-glow var(--twinkle-duration, 2s) ease-in-out infinite;
    animation-delay: var(--twinkle-delay, 0s);
  }

  .wire-connect {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: 6px;
    background: rgba(0, 0, 0, 0.4);
  }

  .bulb::before {
    content: '';
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 6px;
    background: #333;
    border-radius: 2px;
  }

  .bulb::after {
    content: '';
    position: absolute;
    top: 1px;
    left: 2px;
    width: 4px;
    height: 6px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.6) 0%, transparent 50%);
    border-radius: 50%;
  }

  .glow {
    position: absolute;
    top: 6px;
    left: 50%;
    transform: translateX(-50%);
    width: 18px;
    height: 18px;
    border-radius: 50%;
    opacity: 0.6;
    filter: blur(6px);
    background: currentColor;
    animation: twinkle var(--twinkle-duration, 2s) ease-in-out infinite;
    animation-delay: var(--twinkle-delay, 0s);
  }

  .light-red {
    color: #ff0000;
  }

  .light-red .bulb {
    background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
  }

  .light-green {
    color: #00ff00;
  }

  .light-green .bulb {
    background: linear-gradient(135deg, #44ff44 0%, #00cc00 100%);
  }

  .light-blue {
    color: #4444ff;
  }

  .light-blue .bulb {
    background: linear-gradient(135deg, #6666ff 0%, #0000cc 100%);
  }

  .light-yellow {
    color: #ffff00;
  }

  .light-yellow .bulb {
    background: linear-gradient(135deg, #ffff44 0%, #cccc00 100%);
  }

  .light-orange {
    color: #ff8c00;
  }

  .light-orange .bulb {
    background: linear-gradient(135deg, #ffaa44 0%, #cc6600 100%);
  }

  @keyframes twinkle {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.15;
    }
  }

  @keyframes bulb-glow {
    0%, 100% {
      box-shadow:
        inset 0 -2px 4px rgba(0, 0, 0, 0.2),
        0 2px 8px currentColor;
    }
    50% {
      box-shadow:
        inset 0 -2px 4px rgba(0, 0, 0, 0.2),
        0 1px 2px currentColor;
    }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .christmas-lights-container {
      height: 45px;
    }

    .light {
      width: 12px;
      height: 24px;
    }

    .bulb {
      width: 9px;
      height: 12px;
    }

    .glow {
      width: 14px;
      height: 14px;
    }
  }

  @media (max-width: 480px) {
    .lights-wrapper {
      padding: 0 1%;
    }

    .light {
      width: 10px;
      height: 20px;
    }

    .bulb {
      width: 8px;
      height: 10px;
    }

    .glow {
      width: 12px;
      height: 12px;
    }
  }
</style>

<script>
  const now = new Date();
  const month = now.getMonth();
  const day = now.getDate();

  // Show lights: Nov 27 - Dec 31, OR Jan 1
  const isChristmasSeason =
    (month === 10 && day >= 27) ||
    (month === 11) ||
    (month === 0 && day === 1);

  if (isChristmasSeason) {
    // Show all Christmas lights
    document.querySelectorAll('[data-christmas-lights]').forEach(el => {
      el.removeAttribute('hidden');
    });

    // Add padding to parent elements that requested it
    document.querySelectorAll('[data-christmas-padding]').forEach(el => {
      const padding = el.getAttribute('data-christmas-padding');
      if (padding) {
        el.classList.add(padding);
      }
    });
  }
</script>
